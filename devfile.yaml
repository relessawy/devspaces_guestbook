schemaVersion: 2.1.0
metadata:
  name: camel-project
components:
  - name: tools
    container:
      image: quay.io/devfile/universal-developer-image:latest
      memoryRequest: 1Gi
      memoryLimit: 3Gi
      cpuLimit: 1000m
      cpuRequest: 500m
commands:
  - id: init-setup
    exec:
      label: '01: initial setup'
      component: "tools"
      workingDir: "${PROJECT_SOURCE}"
      commandLine: |
        #if sdkman is present use it
        #[[ -s "$HOME/.sdkman/bin/sdkman-init.sh" ]] && source "$HOME/.sdkman/bin/sdkman-init.sh" && sdk default java 17.0.7-tem
        #if no sdkaman do it manually
        #[[ -d /usr/lib/jvm/java-17-openjdk ]] && rm -rf ${HOME}/.java/current/* && ln -s /usr/lib/jvm/java-17-openjdk/* ${HOME}/.java/current
        #copy maven settings pointing to in-cluster nexus mirror
        [[ -s "$PROJECT_SOURCE/settings.xml" ]] && cp -v $PROJECT_SOURCE/settings.xml $HOME/.m2/
        #setup git default config
        git config --local credential.helper store
        git config --local pull.rebase true
        git config --local fetch.prune true
        git config --local diff.colorMoved zebra
        git config user.name "user"
        git config user.email "user@opentlc.com"
        echo "source /usr/share/bash-completion/completions/git" >> /home/user/.bashrc
        oc completion bash > /home/user/.oc_bash_completion
        echo "source /home/user/.oc_bash_completion" >> /home/user/.bashrc  
events:
  postStart:
    - init-setup # <== Start of the workspace happens after this command is completed
